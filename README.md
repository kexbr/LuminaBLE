# LuminaBLE

LuminaBLE — это высокопроизводительное C++ приложение для синхронизации светодиодных лент с аудиопотоком в реальном времени. Проект включает в себя реализацию API для взаимодействия с Bluetooth-контроллерами ELK-BLEDOM, а также систему обработки сигналов для визуализации звука.

## Основные возможности

*   **Reverse Engineering протокола BLE**: Реализован протокол управления контроллерами ELK-BLEDOM (UUID сервиса: `0000fff0-0000-1000-8000-00805f9b34fb`, характеристики: `0000fff3-0000-1000-8000-00805f9b34fb`) для передачи RGB-команд без использования проприетарных мобильных приложений. API для взаимодействия с контроллером предоставлено в классе `Command` 
*   **Захват системного аудио**: Перехват выходного аудиопотока системы (наушники/колонки) через мониторные интерфейсы PulseAudio/PipeWire.
*   **Анализ частот**: Преобразование аудиоданных из временной области в частотную с помощью быстрого преобразования Фурье.
*   **Многопоточная архитектура**: Использование раздельных потоков для захвата звука и передачи данных по Bluetooth через потокобезопасный закольцованный буфер для обеспечения стабильной обработки звука.

## Технологический стек

*   **Язык**: C++17
*   **Bluetooth**: SimpleBLE — библиотека для работы с BLE через BlueZ.
*   **Audio**: RtAudio — библиотека для захвата аудиопотоков.
*   **Math**: FFTW3 — библиотека для вычисления дискретных преобразований Фурье.
*   **Build**: CMake

## Установка и сборка

### Зависимости (Ubuntu)
```bash
sudo apt update
sudo apt install libfftw3-dev librtaudio-dev libdbus-1-dev cmake g++
```
### Сборка
```bash
mkdir build && cd build
cmake ..
make
```
### Настройка прав доступа
Для работы с Bluetooth и звуком одновременно без sudo:
```bash    
sudo setcap 'cap_net_raw,cap_net_admin+eip' ./elk_led
```
### Использование
1. Включите контроллер
2. Убедитесь, что контроллер не подключён к какому-либо устройству
3. Из build запустите `./elk_led`
4. Убедитесь, что выходящий аудиопоток содержит в названии `Output`, иначе пробросьте поток через pactl (пример в `main.cpp`)

  